"use strict";(self.webpackChunksoulseed=self.webpackChunksoulseed||[]).push([[102],{855:(e,t,s)=>{s.d(t,{A:()=>n});s(9950);var r=s(5838),o=s(1538),a=s(1066),l=s(4414);const n=()=>{const{scrollY:e}=(0,o.L)(),t=(0,a.G)(e,[0,1e3],[0,-100]),s=(0,a.G)(e,[0,1e3],[0,-300]),n=(0,a.G)(e,[0,1e3],[0,-500]),i=(0,a.G)(e,[0,1e3],[0,-700]),c=(0,a.G)(e,[0,1e3],[0,50]);return(0,l.jsxs)("div",{className:"fixed inset-0 -z-10 overflow-hidden pointer-events-none",children:[(0,l.jsxs)(r.P.div,{style:{y:t},className:"absolute inset-0",children:[(0,l.jsx)("div",{className:"absolute top-20 left-10 w-96 h-96 bg-purple-300 rounded-full blur-3xl opacity-10"}),(0,l.jsx)("div",{className:"absolute bottom-40 right-20 w-[500px] h-[500px] bg-pink-300 rounded-full blur-3xl opacity-10"}),(0,l.jsx)("div",{className:"absolute top-1/2 left-1/2 w-80 h-80 bg-blue-300 rounded-full blur-3xl opacity-10 -translate-x-1/2 -translate-y-1/2"})]}),(0,l.jsx)(r.P.div,{style:{y:s},className:"absolute inset-0",children:[...Array(20)].map((e,t)=>(0,l.jsx)(r.P.div,{className:"absolute w-16 h-16 bg-gradient-to-br from-purple-400/20 to-pink-400/20 rounded-full blur-md",style:{left:"".concat(100*Math.random(),"%"),top:"".concat(100*Math.random(),"%")},animate:{x:[0,30,0],y:[0,-30,0]},transition:{duration:10+t,repeat:1/0,ease:"easeInOut",repeatType:"mirror"}},t))}),(0,l.jsx)(r.P.div,{style:{y:n},className:"absolute inset-0",children:[...Array(50)].map((e,t)=>(0,l.jsx)("div",{className:"absolute w-2 h-2 bg-white rounded-full opacity-30",style:{left:"".concat(100*Math.random(),"%"),top:"".concat(100*Math.random(),"%")}},t))}),(0,l.jsx)(r.P.div,{style:{y:i,rotate:c},className:"absolute inset-0",children:[...Array(8)].map((e,t)=>(0,l.jsx)("div",{className:"absolute w-32 h-32 bg-gradient-to-br from-white/10 to-transparent border border-white/20 backdrop-blur-sm",style:{left:"".concat(90*Math.random(),"%"),top:"".concat(90*Math.random(),"%"),transform:"rotate(".concat(360*Math.random(),"deg)")}},t))})]})}},8102:(e,t,s)=>{s.r(t),s.d(t,{default:()=>C});var r=s(9950),o=s(9396),a=s(5838),l=s(6429),n=s(7304),i=s(6311),c=s(3147),d=s(5995),u=s(9975),p=s(5692),m=s(9201),h=s(5462),x=s(2257),b=s(8141),g=s(4414);const v={purple:"from-purple-400/20 via-purple-500/20 to-purple-600/20",pink:"from-pink-400/20 via-pink-500/20 to-pink-600/20",blue:"from-blue-400/20 via-blue-500/20 to-blue-600/20",multi:"from-purple-400/20 via-pink-500/20 to-blue-600/20"},f={shallow:{blur:"backdrop-blur-md",shadow:"shadow-[0_4px_16px_rgba(216,178,242,0.15)]",border:"border border-white/20"},medium:{blur:"backdrop-blur-xl",shadow:"shadow-[0_8px_32px_rgba(216,178,242,0.2)]",border:"border border-white/30"},deep:{blur:"backdrop-blur-2xl",shadow:"shadow-[0_16px_48px_rgba(216,178,242,0.3)]",border:"border-2 border-white/40"}},w=e=>{let{children:t,className:s="",hover:r=!0,gradient:o="multi",depth:l="medium"}=e;const n=f[l];return(0,g.jsxs)(a.P.div,{whileHover:r?{scale:1.02,y:-4,boxShadow:"0 20px 60px rgba(216, 178, 242, 0.4)"}:void 0,transition:{type:"spring",stiffness:300,damping:20},style:{transformStyle:"preserve-3d"},className:"\n        relative\n        ".concat(n.blur,"\n        bg-white/10\n        ").concat(n.border,"\n        rounded-2xl\n        ").concat(n.shadow,"\n        overflow-hidden\n        ").concat(s,"\n      "),children:[(0,g.jsx)("div",{className:"\n          absolute -inset-[1px] rounded-2xl\n          bg-gradient-to-br ".concat(v[o],"\n          opacity-50 blur-sm -z-10\n        ")}),(0,g.jsx)("div",{className:" absolute inset-0 bg-gradient-to-br from-white/30 via-transparent to-transparent rounded-2xl opacity-50 pointer-events-none "}),(0,g.jsx)("div",{style:{transform:"translateZ(10px)"},className:"relative z-10",children:t})]})};var y=s(855),j=s(8688);const N=e=>{let{children:t,index:s=0,direction:o="up",className:l=""}=e;const n=(0,r.useRef)(null),i=(0,j.W)(n,{once:!0,amount:.3}),c={up:{initial:{opacity:0,rotateX:60,translateZ:-200,scale:.8,y:100},animate:{opacity:1,rotateX:0,translateZ:0,scale:1,y:0}},down:{initial:{opacity:0,rotateX:-60,translateZ:-200,scale:.8,y:-100},animate:{opacity:1,rotateX:0,translateZ:0,scale:1,y:0}},left:{initial:{opacity:0,rotateY:-60,translateZ:-200,scale:.8,x:-100},animate:{opacity:1,rotateY:0,translateZ:0,scale:1,x:0}},right:{initial:{opacity:0,rotateY:60,translateZ:-200,scale:.8,x:100},animate:{opacity:1,rotateY:0,translateZ:0,scale:1,x:0}}}[o];return(0,g.jsx)(a.P.div,{ref:n,initial:c.initial,animate:i?c.animate:c.initial,transition:{duration:.8,delay:.2*s,ease:[.215,.61,.355,1]},style:{transformStyle:"preserve-3d",perspective:1e3},className:l,children:t})};var k=s(8651),V=s(8940),P=s(8818),A=s(1318);const E=["Title","Names","Settings","Review"];function C(){const e=(0,o.Zp)(),{user:t}=(0,V.A)(),s=(0,P.d)(),[v,f]=(0,r.useState)(0),[j,C]=(0,r.useState)(1),[I,S]=(0,r.useState)(""),[D,B]=(0,r.useState)(""),[T,M]=(0,r.useState)([]),[O,Y]=(0,r.useState)("multiple"),[Z,H]=(0,r.useState)(3),[F,_]=(0,r.useState)(void 0),[G,L]=(0,r.useState)(!1),[z,R]=(0,r.useState)(null),[U,X]=(0,r.useState)(!1),[q,J]=(0,r.useState)(""),[W,Q]=(0,r.useState)([]);(0,r.useEffect)(()=>{const e=A.A.getFavorites();Q(e)},[]);const K=W.filter(e=>e.toLowerCase().includes(q.toLowerCase()));return(0,g.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 relative overflow-hidden py-20 px-4",children:[(0,g.jsx)(y.A,{}),(0,g.jsxs)("div",{className:"max-w-4xl mx-auto relative z-10",children:[(0,g.jsx)(N,{children:(0,g.jsxs)(a.P.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"text-center mb-12",children:[(0,g.jsxs)("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-white/20 backdrop-blur-sm rounded-full mb-6 border border-white/30",children:[(0,g.jsx)(n.A,{className:"w-4 h-4 text-purple-600"}),(0,g.jsx)("span",{className:"text-sm font-medium text-purple-700",children:"Create Your Vote"})]}),(0,g.jsx)("h1",{className:"text-5xl font-bold mb-4 bg-gradient-to-r from-purple-600 via-pink-600 to-blue-600 bg-clip-text text-transparent",children:"Let's Choose Together"}),(0,g.jsx)("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"Create a beautiful voting session and share it with your partner, family, or friends"})]})}),(0,g.jsx)(N,{index:1,children:(0,g.jsx)("div",{className:"flex items-center justify-center gap-2 mb-8",children:E.map((e,t)=>(0,g.jsxs)(r.Fragment,{children:[(0,g.jsxs)(a.P.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.1*t},className:"flex items-center gap-2 px-4 py-2 rounded-full transition-all ".concat(t===v?"bg-gradient-to-r from-purple-600 to-pink-600 text-white shadow-lg":t<v?"bg-green-500 text-white":"bg-white/40 backdrop-blur-sm text-gray-600 border border-white/30"),children:[t<v?(0,g.jsx)(i.A,{className:"w-4 h-4"}):(0,g.jsx)("span",{className:"text-sm font-bold",children:t+1}),(0,g.jsx)("span",{className:"text-sm font-medium hidden sm:inline",children:e})]}),t<E.length-1&&(0,g.jsx)("div",{className:"w-8 h-0.5 ".concat(t<v?"bg-green-500":"bg-gray-300")})]},e))})}),(0,g.jsx)(N,{index:2,children:(0,g.jsx)(w,{className:"p-8 min-h-[500px]",children:(0,g.jsx)(l.N,{mode:"wait",custom:j,children:(0,g.jsxs)(a.P.div,{custom:j,variants:{enter:e=>({rotateY:e>0?90:-90,opacity:0,scale:.8}),center:{rotateY:0,opacity:1,scale:1},exit:e=>({rotateY:e>0?-90:90,opacity:0,scale:.8})},initial:"enter",animate:"center",exit:"exit",transition:{rotateY:{type:"spring",stiffness:100,damping:20},opacity:{duration:.3},scale:{duration:.3}},style:{transformStyle:"preserve-3d",perspective:1e3},children:[0===v&&(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-6",children:"What are you voting on?"}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Vote Title *"}),(0,g.jsx)("input",{type:"text",value:I,onChange:e=>S(e.target.value),placeholder:"e.g., Our Baby Name Choices",className:"w-full px-4 py-3 bg-white/40 backdrop-blur-sm border-2 border-white/30 rounded-xl focus:ring-4 focus:ring-purple-500/20 focus:border-purple-500 outline-none transition-all"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Description (optional)"}),(0,g.jsx)("textarea",{value:D,onChange:e=>B(e.target.value),placeholder:"Add any additional context or instructions...",rows:4,className:"w-full px-4 py-3 bg-white/40 backdrop-blur-sm border-2 border-white/30 rounded-xl focus:ring-4 focus:ring-purple-500/20 focus:border-purple-500 outline-none transition-all resize-none"})]})]}),1===v&&(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-6",children:"Select Names to Vote On"}),(0,g.jsxs)("div",{className:"relative",children:[(0,g.jsx)(c.A,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,g.jsx)("input",{type:"text",value:q,onChange:e=>J(e.target.value),placeholder:"Search your favorite names...",className:"w-full pl-12 pr-4 py-3 bg-white/40 backdrop-blur-sm border-2 border-white/30 rounded-xl focus:ring-4 focus:ring-purple-500/20 focus:border-purple-500 outline-none transition-all"})]}),(0,g.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 bg-purple-100/50 rounded-lg",children:[(0,g.jsxs)("span",{className:"text-sm font-semibold text-purple-700",children:[T.length," names selected"]}),T.length>0&&(0,g.jsx)("button",{onClick:()=>M([]),className:"text-sm text-purple-600 hover:text-purple-700 font-medium",children:"Clear all"})]}),(0,g.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 max-h-[300px] overflow-y-auto",children:K.map(e=>{const t=T.includes(e);return(0,g.jsx)(a.P.button,{onClick:()=>(e=>{M(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(e),whileHover:{scale:1.05},whileTap:{scale:.95},className:"p-3 rounded-lg border-2 font-semibold transition-all ".concat(t?"bg-gradient-to-br from-purple-500 to-pink-500 text-white border-purple-600 shadow-lg":"bg-white/40 backdrop-blur-sm text-gray-700 border-white/30 hover:border-purple-300"),children:(0,g.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,g.jsx)("span",{className:"text-sm",children:e}),t&&(0,g.jsx)(i.A,{className:"w-4 h-4"})]})},e)})}),0===K.length&&(0,g.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,g.jsx)(d.A,{className:"w-12 h-12 mx-auto mb-2 opacity-30"}),(0,g.jsx)("p",{children:"No favorite names yet! Add names to your favorites first."})]})]}),2===v&&(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-6",children:"Voting Settings"}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Vote Type"}),(0,g.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,g.jsxs)("button",{onClick:()=>{Y("single"),H(1)},className:"p-4 rounded-xl border-2 transition-all ".concat("single"===O?"bg-gradient-to-br from-purple-500 to-pink-500 text-white border-purple-600 shadow-lg":"bg-white/40 backdrop-blur-sm text-gray-700 border-white/30 hover:border-purple-300"),children:[(0,g.jsx)(u.A,{className:"w-6 h-6 mx-auto mb-2"}),(0,g.jsx)("div",{className:"font-bold",children:"Single Choice"}),(0,g.jsx)("div",{className:"text-xs opacity-80",children:"Pick one favorite"})]}),(0,g.jsxs)("button",{onClick:()=>Y("multiple"),className:"p-4 rounded-xl border-2 transition-all ".concat("multiple"===O?"bg-gradient-to-br from-purple-500 to-pink-500 text-white border-purple-600 shadow-lg":"bg-white/40 backdrop-blur-sm text-gray-700 border-white/30 hover:border-purple-300"),children:[(0,g.jsx)(d.A,{className:"w-6 h-6 mx-auto mb-2"}),(0,g.jsx)("div",{className:"font-bold",children:"Multiple Choice"}),(0,g.jsx)("div",{className:"text-xs opacity-80",children:"Pick several"})]})]})]}),"multiple"===O&&(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Maximum Votes Per Person"}),(0,g.jsx)("input",{type:"number",min:1,max:T.length,value:Z,onChange:e=>H(parseInt(e.target.value)||1),className:"w-full px-4 py-3 bg-white/40 backdrop-blur-sm border-2 border-white/30 rounded-xl focus:ring-4 focus:ring-purple-500/20 focus:border-purple-500 outline-none transition-all"})]}),(0,g.jsx)("div",{children:(0,g.jsxs)("label",{className:"flex items-center gap-3 cursor-pointer",children:[(0,g.jsx)("input",{type:"checkbox",checked:G,onChange:e=>{L(e.target.checked),e.target.checked&&!F&&_(10)},className:"w-5 h-5 rounded border-2 border-purple-400 text-purple-600 focus:ring-purple-500"}),(0,g.jsxs)("div",{children:[(0,g.jsx)("span",{className:"font-semibold text-gray-700",children:"Use Points Allocation"}),(0,g.jsx)("p",{className:"text-xs text-gray-500",children:"Let voters distribute points across names"})]})]})}),G&&(0,g.jsxs)("div",{children:[(0,g.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[(0,g.jsx)(p.A,{className:"inline w-4 h-4 mr-1"}),"Points Per Voter"]}),(0,g.jsx)("input",{type:"number",min:1,max:100,value:F,onChange:e=>_(parseInt(e.target.value)||10),className:"w-full px-4 py-3 bg-white/40 backdrop-blur-sm border-2 border-white/30 rounded-xl focus:ring-4 focus:ring-purple-500/20 focus:border-purple-500 outline-none transition-all"})]}),(0,g.jsxs)("div",{children:[(0,g.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[(0,g.jsx)(m.A,{className:"inline w-4 h-4 mr-1"}),"Expires On (optional)"]}),(0,g.jsx)("input",{type:"date",onChange:e=>R(e.target.value?new Date(e.target.value):null),className:"w-full px-4 py-3 bg-white/40 backdrop-blur-sm border-2 border-white/30 rounded-xl focus:ring-4 focus:ring-purple-500/20 focus:border-purple-500 outline-none transition-all"})]})]}),3===v&&(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-6",children:"Review & Create"}),(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsxs)("div",{className:"p-4 bg-purple-50/50 rounded-lg",children:[(0,g.jsx)("div",{className:"text-sm font-semibold text-purple-700 mb-1",children:"Title"}),(0,g.jsx)("div",{className:"text-lg font-bold text-gray-800",children:I})]}),D&&(0,g.jsxs)("div",{className:"p-4 bg-purple-50/50 rounded-lg",children:[(0,g.jsx)("div",{className:"text-sm font-semibold text-purple-700 mb-1",children:"Description"}),(0,g.jsx)("div",{className:"text-gray-700",children:D})]}),(0,g.jsxs)("div",{className:"p-4 bg-purple-50/50 rounded-lg",children:[(0,g.jsxs)("div",{className:"text-sm font-semibold text-purple-700 mb-2",children:["Names (",T.length,")"]}),(0,g.jsx)("div",{className:"flex flex-wrap gap-2",children:T.map(e=>(0,g.jsx)("span",{className:"px-3 py-1 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-full text-sm font-medium",children:e},e))})]}),(0,g.jsxs)("div",{className:"p-4 bg-purple-50/50 rounded-lg",children:[(0,g.jsx)("div",{className:"text-sm font-semibold text-purple-700 mb-2",children:"Settings"}),(0,g.jsxs)("ul",{className:"space-y-1 text-gray-700",children:[(0,g.jsxs)("li",{children:["\u2022 Vote Type: ",(0,g.jsx)("strong",{children:"single"===O?"Single Choice":"Multiple Choice"})]}),"multiple"===O&&(0,g.jsxs)("li",{children:["\u2022 Max Votes: ",(0,g.jsx)("strong",{children:Z})]}),G&&(0,g.jsxs)("li",{children:["\u2022 Points Per Voter: ",(0,g.jsx)("strong",{children:F})]}),z&&(0,g.jsxs)("li",{children:["\u2022 Expires: ",(0,g.jsx)("strong",{children:z.toLocaleDateString()})]})]})]})]})]})]},v)})})}),(0,g.jsx)(N,{index:3,children:(0,g.jsxs)("div",{className:"flex justify-between mt-6",children:[v>0&&(0,g.jsxs)(a.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{v>0&&(C(-1),f(e=>e-1))},className:"px-6 py-3 bg-white/40 backdrop-blur-sm text-gray-700 font-semibold rounded-xl border border-white/30 hover:bg-white/60 transition flex items-center gap-2",children:[(0,g.jsx)(h.A,{className:"w-5 h-5"}),"Back"]}),(0,g.jsx)(a.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:v<E.length-1?()=>{v<E.length-1&&(C(1),f(e=>e+1))}:async()=>{if(t)if(T.length<2)s.error("Please select at least 2 names");else try{X(!0);const r=await k.A.createVote(t.id,t.name||"Anonymous",{title:I,description:D,names:T.map(e=>({name:e})),voteType:O,maxVotes:Z,pointsPerVoter:G?F:void 0,isPublic:!0,expiresAt:z});(0,b.A)({particleCount:150,spread:100,origin:{y:.5},colors:["#D8B2F2","#FFB3D9","#B3D9FF"]}),s.success("Vote created successfully!"),e("/vote/".concat(r))}catch(r){console.error("Error creating vote:",r),s.error("Failed to create vote")}finally{X(!1)}else s.error("Please sign in to create a vote")},disabled:U||0===v&&!I||1===v&&T.length<2,className:"ml-auto px-8 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold rounded-xl shadow-lg hover:shadow-xl transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:U?"Creating...":v<E.length-1?(0,g.jsxs)(g.Fragment,{children:["Next",(0,g.jsx)(x.A,{className:"w-5 h-5"})]}):(0,g.jsxs)(g.Fragment,{children:["Create Vote",(0,g.jsx)(n.A,{className:"w-5 h-5"})]})})]})})]})]})}},8651:(e,t,s)=>{s.d(t,{A:()=>l});var r=s(9379),o=s(306),a=s(8081);const l=new class{constructor(){this.collectionName="votes"}async createVote(e,t,s){try{var l;if(!s.title||0===s.title.trim().length)throw new Error("Title is required");if(s.title.length>100)throw new Error("Title must be 100 characters or less");if(s.description&&s.description.length>500)throw new Error("Description must be 500 characters or less");if(s.names.length<2)throw new Error("At least 2 names are required");if(s.names.length>100)throw new Error("Maximum 100 names allowed");if(s.maxVotes>s.names.length)throw new Error("Max votes cannot exceed number of names");const n=(0,o.H9)((0,o.rJ)(a.db,this.collectionName)),i=n.id,c={};s.names.forEach(e=>{c[e.name]=(0,r.A)({count:0,voters:[],voterInfo:[],likes:0,likedBy:[],likeVoterInfo:[]},s.pointsPerVoter?{totalPoints:0,voterPoints:{}}:{})});const d=(0,r.A)((0,r.A)({createdBy:e,createdByName:t,createdAt:o.Dc.now(),updatedAt:o.Dc.now(),title:s.title.trim(),description:(null===(l=s.description)||void 0===l?void 0:l.trim())||"",names:s.names,voteType:s.voteType,maxVotes:s.maxVotes},s.pointsPerVoter?{pointsPerVoter:s.pointsPerVoter}:{}),{},{isPublic:s.isPublic,expiresAt:s.expiresAt?o.Dc.fromDate(s.expiresAt):null,status:"active",votes:c,totalVoters:0,allVoters:[],stats:{totalVotesCast:0,lastVoteAt:null}});return await(0,o.BN)(n,d),i}catch(n){throw console.error("Error creating vote:",n),n}}async getVote(e){try{const t=(0,o.H9)(a.db,this.collectionName,e),s=await(0,o.x7)(t);if(!s.exists())return null;const l=s.data();return l.expiresAt&&l.expiresAt.toDate()<new Date&&"active"===l.status&&(await(0,o.mZ)(t,{status:"expired"}),l.status="expired"),(0,r.A)({id:s.id},l)}catch(t){throw console.error("Error getting vote:",t),t}}async submitVote(e){try{const{voteId:t,selectedNames:s,namePoints:l,voterId:n,voterName:i,voterAvatar:c}=e,d=(0,o.H9)(a.db,this.collectionName,t);await(0,o.c4)(a.db,async e=>{const t=await e.get(d);if(!t.exists())throw new Error("Vote not found");const a=t.data();if("active"!==a.status)throw new Error("This vote is no longer active");if(a.expiresAt&&a.expiresAt.toDate()<new Date)throw new Error("This vote has expired");const u=(0,r.A)({},a.votes),p=Object.values(u).some(e=>{var t,s;return(null===(t=e.voters)||void 0===t?void 0:t.includes(n))||(null===(s=e.voterPoints)||void 0===s?void 0:s[n])});let m=!p;const h={id:n,name:i,avatar:c,votedAt:o.Dc.now()};if(a.pointsPerVoter&&l){const t=Object.values(l).reduce((e,t)=>e+t,0);if(t>a.pointsPerVoter)throw new Error("You can only allocate ".concat(a.pointsPerVoter," points total"));p&&Object.keys(u).forEach(e=>{if(u[e].voterPoints&&u[e].voterPoints[n]){const t=u[e].voterPoints[n];u[e].totalPoints=(u[e].totalPoints||0)-t,delete u[e].voterPoints[n]}}),Object.entries(l).forEach(e=>{let[t,s]=e;if(s>0){u[t]||(u[t]={count:0,voters:[],voterInfo:[],totalPoints:0,voterPoints:{}}),u[t].voterPoints||(u[t].voterPoints={}),u[t].totalPoints||(u[t].totalPoints=0),u[t].voterInfo||(u[t].voterInfo=[]),u[t].voterPoints[n]=s,u[t].totalPoints=(u[t].totalPoints||0)+s;const e=u[t].voterInfo.findIndex(e=>e.id===n);e>=0?u[t].voterInfo[e]=h:u[t].voterInfo.push(h)}});let s=a.allVoters||[];const r=s.findIndex(e=>e.id===n);r>=0?s[r]=h:s=[...s,h],e.update(d,{votes:u,allVoters:s,totalVoters:m?a.totalVoters+1:a.totalVoters,"stats.totalVotesCast":a.stats.totalVotesCast+t,"stats.lastVoteAt":o.Dc.now(),updatedAt:o.Dc.now()})}else{if(!s)throw new Error("Invalid submission: must provide either selectedNames or namePoints");{if(s.length>a.maxVotes)throw new Error("You can only vote for ".concat(a.maxVotes," name(s)"));if(0===s.length)throw new Error("Please select at least one name");p&&Object.keys(u).forEach(e=>{u[e].voters.includes(n)&&(u[e].voters=u[e].voters.filter(e=>e!==n),u[e].count=u[e].voters.length)}),s.forEach(e=>{u[e]||(u[e]={count:0,voters:[],voterInfo:[]}),u[e].voterInfo||(u[e].voterInfo=[]),u[e].voters.includes(n)||(u[e].voters.push(n),u[e].count=u[e].voters.length,u[e].voterInfo.push(h))});let t=a.allVoters||[];const r=t.findIndex(e=>e.id===n);r>=0?t[r]=h:t=[...t,h],e.update(d,{votes:u,allVoters:t,totalVoters:m?a.totalVoters+1:a.totalVoters,"stats.totalVotesCast":a.stats.totalVotesCast+s.length,"stats.lastVoteAt":o.Dc.now(),updatedAt:o.Dc.now()})}}})}catch(t){throw console.error("Error submitting vote:",t),t}}async getResults(e){try{const t=await this.getVote(e);if(!t)throw new Error("Vote not found");const s=[],r=!!t.pointsPerVoter,o=Object.values(t.votes).reduce((e,t)=>e+(r?t.totalPoints||0:t.count),0);return Object.entries(t.votes).forEach(e=>{let[t,a]=e;const l=r?a.totalPoints||0:a.count;s.push({name:t,count:l,percentage:o>0?l/o*100:0,rank:0})}),s.sort((e,t)=>t.count-e.count),s.forEach((e,t)=>{e.rank=t+1}),s}catch(t){throw console.error("Error getting results:",t),t}}async getUserVotes(e){try{const t=(0,o.rJ)(a.db,this.collectionName),s=(0,o.P)(t,(0,o._M)("createdBy","==",e)),l=await(0,o.GG)(s),n=[];return l.forEach(e=>{n.push((0,r.A)({id:e.id},e.data()))}),n}catch(t){throw console.error("Error getting user votes:",t),t}}async deleteVote(e,t){try{const s=(0,o.H9)(a.db,this.collectionName,e),r=await(0,o.x7)(s);if(!r.exists())throw new Error("Vote not found");if(r.data().createdBy!==t)throw new Error("Only the creator can delete this vote");await(0,o.kd)(s)}catch(s){throw console.error("Error deleting vote:",s),s}}async closeVote(e,t){try{const s=(0,o.H9)(a.db,this.collectionName,e),r=await(0,o.x7)(s);if(!r.exists())throw new Error("Vote not found");if(r.data().createdBy!==t)throw new Error("Only the creator can close this vote");await(0,o.mZ)(s,{status:"closed",updatedAt:o.Dc.now()})}catch(s){throw console.error("Error closing vote:",s),s}}subscribeToVote(e,t){const s=(0,o.H9)(a.db,this.collectionName,e);return(0,o.aQ)(s,e=>{e.exists()?t((0,r.A)({id:e.id},e.data())):t(null)},e=>{console.error("Error listening to vote updates:",e),t(null)})}async hasUserVoted(e,t){try{const s=await this.getVote(e);return!!s&&Object.values(s.votes).some(e=>{var s;return null===(s=e.voters)||void 0===s?void 0:s.includes(t)})}catch(s){return console.error("Error checking if user voted:",s),!1}}async getUserSelection(e,t){try{const s=await this.getVote(e);if(!s)return[];const r=[];return Object.entries(s.votes).forEach(e=>{let[s,o]=e;o.voters.includes(t)&&r.push(s)}),r}catch(s){return console.error("Error getting user selection:",s),[]}}async toggleLike(e,t,s,l,n){try{const i=(0,o.H9)(a.db,this.collectionName,e);await(0,o.c4)(a.db,async e=>{const a=await e.get(i);if(!a.exists())throw new Error("Vote not found");const c=a.data(),d=(0,r.A)({},c.votes);d[t]||(d[t]={count:0,voters:[],voterInfo:[],likes:0,likedBy:[],likeVoterInfo:[]}),d[t].likedBy||(d[t].likedBy=[],d[t].likes=0),d[t].likeVoterInfo||(d[t].likeVoterInfo=[]);const u=d[t].likedBy,p=u.includes(s),m={id:s,name:l,avatar:n,votedAt:o.Dc.now()};p?(d[t].likedBy=u.filter(e=>e!==s),d[t].likes=Math.max(0,(d[t].likes||0)-1),d[t].likeVoterInfo=d[t].likeVoterInfo.filter(e=>e.id!==s)):(d[t].likedBy=[...u,s],d[t].likes=(d[t].likes||0)+1,d[t].likeVoterInfo.push(m));let h=c.allVoters||[];const x=h.findIndex(e=>e.id===s);x>=0?h[x]=m:h=[...h,m],e.update(i,{votes:d,allVoters:h,updatedAt:o.Dc.now()})})}catch(i){throw console.error("Error toggling like:",i),i}}}}}]);
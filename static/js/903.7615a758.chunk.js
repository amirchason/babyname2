"use strict";(self.webpackChunksoulseed=self.webpackChunksoulseed||[]).push([[903],{855:(e,t,s)=>{s.d(t,{A:()=>n});s(9950);var r=s(4184),o=s(1538),a=s(1066),l=s(4414);const n=()=>{const{scrollY:e}=(0,o.L)(),t=(0,a.G)(e,[0,1e3],[0,-100]),s=(0,a.G)(e,[0,1e3],[0,-300]),n=(0,a.G)(e,[0,1e3],[0,-500]),i=(0,a.G)(e,[0,1e3],[0,-700]),c=(0,a.G)(e,[0,1e3],[0,50]);return(0,l.jsxs)("div",{className:"fixed inset-0 -z-10 overflow-hidden pointer-events-none",children:[(0,l.jsxs)(r.P.div,{style:{y:t},className:"absolute inset-0",children:[(0,l.jsx)("div",{className:"absolute top-20 left-10 w-96 h-96 bg-purple-300 rounded-full blur-3xl opacity-10"}),(0,l.jsx)("div",{className:"absolute bottom-40 right-20 w-[500px] h-[500px] bg-pink-300 rounded-full blur-3xl opacity-10"}),(0,l.jsx)("div",{className:"absolute top-1/2 left-1/2 w-80 h-80 bg-blue-300 rounded-full blur-3xl opacity-10 -translate-x-1/2 -translate-y-1/2"})]}),(0,l.jsx)(r.P.div,{style:{y:s},className:"absolute inset-0",children:[...Array(20)].map((e,t)=>(0,l.jsx)(r.P.div,{className:"absolute w-16 h-16 bg-gradient-to-br from-purple-400/20 to-pink-400/20 rounded-full blur-md",style:{left:"".concat(100*Math.random(),"%"),top:"".concat(100*Math.random(),"%")},animate:{x:[0,30,0],y:[0,-30,0]},transition:{duration:10+t,repeat:1/0,ease:"easeInOut",repeatType:"mirror"}},t))}),(0,l.jsx)(r.P.div,{style:{y:n},className:"absolute inset-0",children:[...Array(50)].map((e,t)=>(0,l.jsx)("div",{className:"absolute w-2 h-2 bg-white rounded-full opacity-30",style:{left:"".concat(100*Math.random(),"%"),top:"".concat(100*Math.random(),"%")}},t))}),(0,l.jsx)(r.P.div,{style:{y:i,rotate:c},className:"absolute inset-0",children:[...Array(8)].map((e,t)=>(0,l.jsx)("div",{className:"absolute w-32 h-32 bg-gradient-to-br from-white/10 to-transparent border border-white/20 backdrop-blur-sm",style:{left:"".concat(90*Math.random(),"%"),top:"".concat(90*Math.random(),"%"),transform:"rotate(".concat(360*Math.random(),"deg)")}},t))})]})}},3284:(e,t,s)=>{s.r(t),s.d(t,{default:()=>I});var r=s(9950),o=s(9396),a=s(2856),l=s(4184),n=s(6429),i=s(6311),c=s(5833),d=s(8130),u=s(2263),h=s(4814),m=s(5995),p=s(7304),x=s(9201),b=s(5462),v=s(2257),g=s(8141),f=s(4414);const w={purple:"from-purple-400/20 via-purple-500/20 to-purple-600/20",pink:"from-pink-400/20 via-pink-500/20 to-pink-600/20",blue:"from-blue-400/20 via-blue-500/20 to-blue-600/20",multi:"from-purple-400/20 via-pink-500/20 to-blue-600/20"},y={shallow:{blur:"backdrop-blur-md",shadow:"shadow-[0_4px_16px_rgba(216,178,242,0.15)]",border:"border border-white/20"},medium:{blur:"backdrop-blur-xl",shadow:"shadow-[0_8px_32px_rgba(216,178,242,0.2)]",border:"border border-white/30"},deep:{blur:"backdrop-blur-2xl",shadow:"shadow-[0_16px_48px_rgba(216,178,242,0.3)]",border:"border-2 border-white/40"}},j=e=>{let{children:t,className:s="",hover:r=!0,gradient:o="multi",depth:a="medium"}=e;const n=y[a];return(0,f.jsxs)(l.P.div,{whileHover:r?{scale:1.02,y:-4,boxShadow:"0 20px 60px rgba(216, 178, 242, 0.4)"}:void 0,transition:{type:"spring",stiffness:300,damping:20},style:{transformStyle:"preserve-3d"},className:"\n        relative\n        ".concat(n.blur,"\n        bg-white/10\n        ").concat(n.border,"\n        rounded-2xl\n        ").concat(n.shadow,"\n        overflow-hidden\n        ").concat(s,"\n      "),children:[(0,f.jsx)("div",{className:"\n          absolute -inset-[1px] rounded-2xl\n          bg-gradient-to-br ".concat(w[o],"\n          opacity-50 blur-sm -z-10\n        ")}),(0,f.jsx)("div",{className:" absolute inset-0 bg-gradient-to-br from-white/30 via-transparent to-transparent rounded-2xl opacity-50 pointer-events-none "}),(0,f.jsx)("div",{style:{transform:"translateZ(10px)"},className:"relative z-10",children:t})]})};var N=s(855),k=s(8651),V=s(1586),A=s(8818),P=s(1318);const E=["Title","Names","Settings","Review"];function I(){const e=(0,o.Zp)(),{user:t}=(0,V.A)(),s=(0,A.d)(),[w,y]=(0,r.useState)(0),[I,C]=(0,r.useState)(1),S=["Vote for our future baby's name!","Help us choose the perfect name!","Which name do you love most?"],[T,D]=(0,r.useState)(S[0]),[B,H]=(0,r.useState)(0),[O,F]=(0,r.useState)([]),[q,M]=(0,r.useState)("multiple"),[_,Y]=(0,r.useState)(3),[G,L]=(0,r.useState)(void 0),[z,Q]=(0,r.useState)(!1),[R,Z]=(0,r.useState)(null),[U,J]=(0,r.useState)(!1),[W,K]=(0,r.useState)([]),[X,$]=(0,r.useState)("top10");(0,r.useEffect)(()=>{const e=P.A.getFavorites(),t=P.A.getPinnedFavorites(),s=[...t,...e.filter(e=>!t.includes(e))];K(s);const r=s.slice(0,10);F(r)},[]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)(a.mg,{children:[(0,f.jsx)("title",{children:"Create Baby Name Vote - Share & Vote with Your Partner | SoulSeed"}),(0,f.jsx)("meta",{name:"description",content:"Create a baby name voting session to share with your partner. Select your favorite names and let everyone vote on their top choices together!"}),(0,f.jsx)("link",{rel:"canonical",href:"https://soulseedbaby.com/create-vote"})]}),(0,f.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 relative overflow-hidden py-4 px-4",children:[(0,f.jsx)(N.A,{}),(0,f.jsxs)("div",{className:"max-w-4xl mx-auto relative z-10",children:[(0,f.jsx)("div",{className:"flex items-center justify-center gap-2 mb-4",children:E.map((e,t)=>(0,f.jsxs)(r.Fragment,{children:[(0,f.jsxs)(l.P.div,{initial:{scale:1},animate:{scale:1},className:"flex items-center gap-2 px-4 py-2 rounded-full transition-all ".concat(t===w?"bg-gradient-to-r from-purple-600 to-pink-600 text-white shadow-lg":t<w?"bg-green-500 text-white":"bg-white/40 backdrop-blur-sm text-gray-600 border border-white/30"),children:[t<w?(0,f.jsx)(i.A,{className:"w-4 h-4"}):(0,f.jsx)("span",{className:"text-sm font-bold",children:t+1}),(0,f.jsx)("span",{className:"text-sm font-medium hidden sm:inline",children:e})]}),t<E.length-1&&(0,f.jsx)("div",{className:"w-8 h-0.5 ".concat(t<w?"bg-green-500":"bg-gray-300")})]},e))}),(0,f.jsx)(j,{className:"p-4 min-h-[400px]",children:(0,f.jsx)(n.N,{mode:"wait",custom:I,children:(0,f.jsxs)(l.P.div,{custom:I,variants:{enter:e=>({rotateY:e>0?90:-90,opacity:0,scale:.8}),center:{rotateY:0,opacity:1,scale:1},exit:e=>({rotateY:e>0?-90:90,opacity:0,scale:.8})},initial:"enter",animate:"center",exit:"exit",transition:{rotateY:{type:"spring",stiffness:100,damping:20},opacity:{duration:.3},scale:{duration:.3}},style:{transformStyle:"preserve-3d",perspective:1e3},children:[0===w&&(0,f.jsxs)("div",{className:"space-y-6",children:[(0,f.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-6",children:"What are you voting on?"}),(0,f.jsxs)("div",{className:"space-y-3",children:[(0,f.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Choose a ready-made title:"}),(0,f.jsx)("div",{className:"grid grid-cols-1 gap-3",children:S.map((e,t)=>(0,f.jsx)(l.P.button,{type:"button",onClick:()=>{D(e),H(t)},whileHover:{scale:1.02},whileTap:{scale:.98},className:"w-full p-4 rounded-xl transition-all text-left ".concat(B===t?"bg-gradient-to-br from-purple-500 to-pink-500 text-white border-2 border-purple-600 shadow-lg":"bg-gradient-to-br from-purple-50 to-pink-50 border-2 border-purple-200 hover:border-purple-400 text-gray-800"),children:(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsx)("p",{className:"text-base font-bold ".concat(B===t?"text-white":"text-gray-800"),children:e}),B===t&&(0,f.jsx)(i.A,{className:"w-5 h-5 text-white"})]})},t))})]}),(0,f.jsxs)("div",{className:"space-y-3",children:[(0,f.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Or write your own:"}),(0,f.jsx)("input",{type:"text",value:null===B?T:"",onChange:e=>{D(e.target.value),H(null)},onFocus:()=>{null!==B&&(D(""),H(null))},placeholder:"Enter your custom title...",maxLength:100,className:"w-full px-4 py-3 bg-white/40 backdrop-blur-sm border-2 border-white/30 rounded-xl focus:ring-4 focus:ring-purple-500/20 focus:border-purple-500 outline-none transition-all text-gray-800 font-medium"}),null===B&&(0,f.jsxs)("div",{className:"text-xs text-gray-500 text-right",children:[T.length,"/100"]})]})]}),1===w&&(0,f.jsxs)("div",{className:"space-y-3",children:[(0,f.jsxs)("div",{className:"space-y-1.5",children:[(0,f.jsx)("div",{className:"flex items-center justify-center",children:(0,f.jsx)(l.P.div,{initial:{scale:1},animate:{scale:O.length>0?1.02:1},className:"px-3 py-1.5 bg-gradient-to-r from-purple-100 to-pink-100 rounded-full border border-purple-200",children:(0,f.jsxs)("span",{className:"text-xs font-bold text-purple-700",children:[O.length," ",1===O.length?"name":"names"," selected"]})})}),(0,f.jsxs)("div",{className:"flex gap-1.5 justify-center",children:[(0,f.jsx)(l.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{F([...W]),$("all"),s.success("Selected all ".concat(W.length," names!"))},disabled:0===W.length||O.length===W.length,className:"px-2.5 py-1.5 border-2 font-bold rounded-full transition-all disabled:opacity-30 disabled:cursor-not-allowed disabled:hover:scale-100 ".concat("all"===X?"bg-gradient-to-r from-blue-500 to-cyan-600 border-blue-600 text-white shadow-md":"border-blue-500 text-blue-600 hover:border-blue-600 backdrop-blur-sm bg-white/50"),children:(0,f.jsxs)("div",{className:"flex items-center gap-1",children:[(0,f.jsx)(c.A,{className:"w-3 h-3"}),(0,f.jsx)("span",{className:"text-xs",children:"All"})]})}),(0,f.jsx)(l.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{const e=W.slice(0,3);F(e),$("top3"),s.success("Selected top 3 favorite names!")},disabled:W.length<3,className:"px-2.5 py-1.5 border-2 font-bold rounded-full transition-all disabled:opacity-30 disabled:cursor-not-allowed disabled:hover:scale-100 ".concat("top3"===X?"bg-gradient-to-r from-blue-500 to-cyan-600 border-blue-600 text-white shadow-md":"border-blue-500 text-blue-600 hover:border-blue-600 backdrop-blur-sm bg-white/50"),children:(0,f.jsxs)("div",{className:"flex items-center gap-1",children:[(0,f.jsx)(d.A,{className:"w-3 h-3"}),(0,f.jsx)("span",{className:"text-xs",children:"Top 3"})]})}),(0,f.jsx)(l.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{const e=W.slice(0,10);F(e),$("top10"),s.success("Selected top 10 favorite names!")},disabled:W.length<10,className:"px-2.5 py-1.5 border-2 font-bold rounded-full transition-all disabled:opacity-30 disabled:cursor-not-allowed disabled:hover:scale-100 ".concat("top10"===X?"bg-gradient-to-r from-blue-500 to-cyan-600 border-blue-600 text-white shadow-md":"border-blue-500 text-blue-600 hover:border-blue-600 backdrop-blur-sm bg-white/50"),children:(0,f.jsxs)("div",{className:"flex items-center gap-1",children:[(0,f.jsx)(u.A,{className:"w-3 h-3"}),(0,f.jsx)("span",{className:"text-xs",children:"Top 10"})]})}),(0,f.jsx)(l.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{F([]),$("clear"),s.success("Cleared all selections")},disabled:0===O.length,className:"px-2.5 py-1.5 border-2 font-bold rounded-full transition-all disabled:opacity-30 disabled:cursor-not-allowed disabled:hover:scale-100 ".concat("clear"===X?"bg-gradient-to-r from-rose-400 to-red-500 border-red-500 text-white shadow-md":"border-red-400 text-red-500 hover:border-red-500 backdrop-blur-sm bg-white/50"),children:(0,f.jsxs)("div",{className:"flex items-center gap-1",children:[(0,f.jsx)(h.A,{className:"w-3 h-3"}),(0,f.jsx)("span",{className:"text-xs",children:"Clear"})]})})]})]}),(0,f.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 max-h-[240px] overflow-y-auto",children:W.map(e=>{const t=O.includes(e);return(0,f.jsx)(l.P.button,{onClick:()=>(e=>{F(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e]),$(null)})(e),whileHover:{scale:1.05},whileTap:{scale:.95},className:"p-2 rounded-lg border-2 font-semibold transition-all ".concat(t?"bg-gradient-to-br from-purple-500 to-pink-500 text-white border-purple-600 shadow-lg":"bg-white/40 backdrop-blur-sm text-gray-700 border-white/30 hover:border-purple-300"),children:(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsx)("span",{className:"text-sm",children:e}),t&&(0,f.jsx)(i.A,{className:"w-3.5 h-3.5"})]})},e)})}),0===W.length&&(0,f.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,f.jsx)(m.A,{className:"w-12 h-12 mx-auto mb-2 opacity-30"}),(0,f.jsx)("p",{className:"mb-4",children:"No favorite names yet! Add names to your favorites first."}),(0,f.jsxs)(l.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>e("/"),className:"px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold rounded-xl shadow-lg hover:shadow-xl transition-all inline-flex items-center gap-2",children:[(0,f.jsx)(p.A,{className:"w-5 h-5"}),"Browse Names"]})]})]}),2===w&&(0,f.jsxs)("div",{className:"space-y-6",children:[(0,f.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-6",children:"Voting Settings"}),(0,f.jsxs)("div",{children:[(0,f.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[(0,f.jsx)(m.A,{className:"inline w-4 h-4 mr-1"}),"Number of Votes Per Person"]}),(0,f.jsx)("input",{type:"number",min:1,max:O.length,value:_,onChange:e=>Y(parseInt(e.target.value)||1),className:"w-full px-4 py-3 bg-white/40 backdrop-blur-sm border-2 border-white/30 rounded-xl focus:ring-4 focus:ring-purple-500/20 focus:border-purple-500 outline-none transition-all"}),(0,f.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Each voter can select up to ",_," ",1===_?"name":"names"]})]}),(0,f.jsxs)("div",{children:[(0,f.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[(0,f.jsx)(x.A,{className:"inline w-4 h-4 mr-1"}),"Expires On (optional)"]}),(0,f.jsx)("input",{type:"date",onChange:e=>Z(e.target.value?new Date(e.target.value):null),className:"w-full px-4 py-3 bg-white/40 backdrop-blur-sm border-2 border-white/30 rounded-xl focus:ring-4 focus:ring-purple-500/20 focus:border-purple-500 outline-none transition-all"}),(0,f.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Leave empty for no expiration"})]})]}),3===w&&(0,f.jsxs)("div",{className:"space-y-6",children:[(0,f.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-6",children:"Review & Create"}),(0,f.jsxs)("div",{className:"space-y-4",children:[(0,f.jsxs)("div",{className:"p-4 bg-purple-50/50 rounded-lg",children:[(0,f.jsx)("div",{className:"text-sm font-semibold text-purple-700 mb-1",children:"Title"}),(0,f.jsx)("div",{className:"text-lg font-bold text-gray-800",children:T})]}),(0,f.jsxs)("div",{className:"p-4 bg-purple-50/50 rounded-lg",children:[(0,f.jsxs)("div",{className:"text-sm font-semibold text-purple-700 mb-2",children:["Names (",O.length,")"]}),(0,f.jsx)("div",{className:"flex flex-wrap gap-2",children:O.map(e=>(0,f.jsx)("span",{className:"px-3 py-1 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-full text-sm font-medium",children:e},e))})]}),(0,f.jsxs)("div",{className:"p-4 bg-purple-50/50 rounded-lg",children:[(0,f.jsx)("div",{className:"text-sm font-semibold text-purple-700 mb-2",children:"Settings"}),(0,f.jsxs)("ul",{className:"space-y-1 text-gray-700",children:[(0,f.jsxs)("li",{children:["\u2022 Votes Per Person: ",(0,f.jsx)("strong",{children:_})]}),R?(0,f.jsxs)("li",{children:["\u2022 Expires: ",(0,f.jsx)("strong",{children:R.toLocaleDateString()})]}):(0,f.jsxs)("li",{children:["\u2022 Expires: ",(0,f.jsx)("strong",{children:"Never"})]})]})]})]})]})]},w)})}),(0,f.jsxs)("div",{className:"flex justify-between mt-4",children:[w>0&&(0,f.jsxs)(l.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{w>0&&(C(-1),y(e=>e-1))},className:"px-6 py-3 bg-white/40 backdrop-blur-sm text-gray-700 font-semibold rounded-xl border border-white/30 hover:bg-white/60 transition flex items-center gap-2",children:[(0,f.jsx)(b.A,{className:"w-5 h-5"}),"Back"]}),(0,f.jsx)(l.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:w<E.length-1?()=>{w<E.length-1&&(C(1),y(e=>e+1))}:async()=>{if(!t)return void s.error("Please sign in to create a vote");if(O.length<2)return void s.error("Please select at least 2 names");const r=T.trim();if(r)try{J(!0);const o=await k.A.createVote(t.id,t.name||"Anonymous",{title:r,names:O.map(e=>({name:e})),voteType:q,maxVotes:_,pointsPerVoter:z?G:void 0,isPublic:!0,expiresAt:R});(0,g.A)({particleCount:150,spread:100,origin:{y:.5},colors:["#D8B2F2","#FFB3D9","#B3D9FF"]}),s.success("Vote created successfully!"),e("/vote/".concat(o))}catch(o){console.error("Error creating vote:",o),s.error("Failed to create vote")}finally{J(!1)}else s.error("Please enter a title")},disabled:U||0===w&&!T.trim()||1===w&&O.length<2,className:"ml-auto px-8 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold rounded-xl shadow-lg hover:shadow-xl transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:U?"Creating...":w<E.length-1?(0,f.jsxs)(f.Fragment,{children:["Next",(0,f.jsx)(v.A,{className:"w-5 h-5"})]}):(0,f.jsxs)(f.Fragment,{children:["Create Vote",(0,f.jsx)(p.A,{className:"w-5 h-5"})]})})]})]})]})]})}},8651:(e,t,s)=>{s.d(t,{A:()=>l});var r=s(9379),o=s(306),a=s(8081);const l=new class{constructor(){this.collectionName="votes"}async createVote(e,t,s){try{var l;if(!s.title||0===s.title.trim().length)throw new Error("Title is required");if(s.title.length>100)throw new Error("Title must be 100 characters or less");if(s.description&&s.description.length>500)throw new Error("Description must be 500 characters or less");if(s.names.length<2)throw new Error("At least 2 names are required");if(s.names.length>100)throw new Error("Maximum 100 names allowed");if(s.maxVotes>s.names.length)throw new Error("Max votes cannot exceed number of names");const n=(0,o.H9)((0,o.rJ)(a.db,this.collectionName)),i=n.id,c={};s.names.forEach(e=>{c[e.name]=(0,r.A)({count:0,voters:[],voterInfo:[],likes:0,likedBy:[],likeVoterInfo:[]},s.pointsPerVoter?{totalPoints:0,voterPoints:{}}:{})});const d=(0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)((0,r.A)({createdBy:e,createdByName:t,createdAt:o.Dc.now(),updatedAt:o.Dc.now(),title:s.title.trim(),description:(null===(l=s.description)||void 0===l?void 0:l.trim())||"",names:s.names,voteType:s.voteType,maxVotes:s.maxVotes},s.pointsPerVoter?{pointsPerVoter:s.pointsPerVoter}:{}),{},{isPublic:s.isPublic,expiresAt:s.expiresAt?o.Dc.fromDate(s.expiresAt):null,status:"active",votes:c,totalVoters:0,allVoters:[]},s.votingQuestion?{votingQuestion:s.votingQuestion}:{}),s.questionType?{questionType:s.questionType}:{}),s.questionId?{questionId:s.questionId}:{}),s.questionEmoji?{questionEmoji:s.questionEmoji}:{}),{},{stats:{totalVotesCast:0,lastVoteAt:null}});return await(0,o.BN)(n,d),i}catch(n){throw console.error("Error creating vote:",n),n}}async getVote(e){try{const t=(0,o.H9)(a.db,this.collectionName,e),s=await(0,o.x7)(t);if(!s.exists())return null;const l=s.data();return l.expiresAt&&l.expiresAt.toDate()<new Date&&"active"===l.status&&(await(0,o.mZ)(t,{status:"expired"}),l.status="expired"),(0,r.A)({id:s.id},l)}catch(t){throw console.error("Error getting vote:",t),t}}async submitVote(e){try{const{voteId:t,selectedNames:s,namePoints:l,voterId:n,voterName:i,voterAvatar:c,voteReasons:d,reasonTypes:u}=e,h=(0,o.H9)(a.db,this.collectionName,t);await(0,o.c4)(a.db,async e=>{const t=await e.get(h);if(!t.exists())throw new Error("Vote not found");const a=t.data();if("active"!==a.status)throw new Error("This vote is no longer active");if(a.expiresAt&&a.expiresAt.toDate()<new Date)throw new Error("This vote has expired");const m=(0,r.A)({},a.votes),p=Object.values(m).some(e=>{var t,s;return(null===(t=e.voters)||void 0===t?void 0:t.includes(n))||(null===(s=e.voterPoints)||void 0===s?void 0:s[n])});let x=!p;const b={id:n,name:i,avatar:c,votedAt:o.Dc.now()};if(a.pointsPerVoter&&l){const t=Object.values(l).reduce((e,t)=>e+t,0);if(t>a.pointsPerVoter)throw new Error("You can only allocate ".concat(a.pointsPerVoter," points total"));p&&Object.keys(m).forEach(e=>{if(m[e].voterPoints&&m[e].voterPoints[n]){const t=m[e].voterPoints[n];m[e].totalPoints=(m[e].totalPoints||0)-t,delete m[e].voterPoints[n]}}),Object.entries(l).forEach(e=>{let[t,s]=e;if(s>0){m[t]||(m[t]={count:0,voters:[],voterInfo:[],totalPoints:0,voterPoints:{}}),m[t].voterPoints||(m[t].voterPoints={}),m[t].totalPoints||(m[t].totalPoints=0),m[t].voterInfo||(m[t].voterInfo=[]),m[t].voterPoints[n]=s,m[t].totalPoints=(m[t].totalPoints||0)+s;const e=(0,r.A)((0,r.A)({},b),{},{reason:null===d||void 0===d?void 0:d[t],reasonType:null===u||void 0===u?void 0:u[t]}),o=m[t].voterInfo.findIndex(e=>e.id===n);o>=0?m[t].voterInfo[o]=e:m[t].voterInfo.push(e)}});let s=a.allVoters||[];const i=s.findIndex(e=>e.id===n);i>=0?s[i]=b:s=[...s,b],e.update(h,{votes:m,allVoters:s,totalVoters:x?a.totalVoters+1:a.totalVoters,"stats.totalVotesCast":a.stats.totalVotesCast+t,"stats.lastVoteAt":o.Dc.now(),updatedAt:o.Dc.now()})}else{if(!s)throw new Error("Invalid submission: must provide either selectedNames or namePoints");{if(s.length>a.maxVotes)throw new Error("You can only vote for ".concat(a.maxVotes," name(s)"));if(0===s.length)throw new Error("Please select at least one name");p&&Object.keys(m).forEach(e=>{m[e].voters.includes(n)&&(m[e].voters=m[e].voters.filter(e=>e!==n),m[e].count=m[e].voters.length)}),s.forEach(e=>{if(m[e]||(m[e]={count:0,voters:[],voterInfo:[]}),m[e].voterInfo||(m[e].voterInfo=[]),!m[e].voters.includes(n)){m[e].voters.push(n),m[e].count=m[e].voters.length;const t=(0,r.A)((0,r.A)({},b),{},{reason:null===d||void 0===d?void 0:d[e],reasonType:null===u||void 0===u?void 0:u[e]});m[e].voterInfo.push(t)}});let t=a.allVoters||[];const l=t.findIndex(e=>e.id===n);l>=0?t[l]=b:t=[...t,b],e.update(h,{votes:m,allVoters:t,totalVoters:x?a.totalVoters+1:a.totalVoters,"stats.totalVotesCast":a.stats.totalVotesCast+s.length,"stats.lastVoteAt":o.Dc.now(),updatedAt:o.Dc.now()})}}})}catch(t){throw console.error("Error submitting vote:",t),t}}async getResults(e){try{const t=await this.getVote(e);if(!t)throw new Error("Vote not found");const s=[],r=!!t.pointsPerVoter,o=Object.values(t.votes).reduce((e,t)=>e+(r?t.totalPoints||0:t.count),0);return Object.entries(t.votes).forEach(e=>{let[t,a]=e;const l=r?a.totalPoints||0:a.count;s.push({name:t,count:l,percentage:o>0?l/o*100:0,rank:0})}),s.sort((e,t)=>t.count-e.count),s.forEach((e,t)=>{e.rank=t+1}),s}catch(t){throw console.error("Error getting results:",t),t}}async getUserVotes(e){try{const t=(0,o.rJ)(a.db,this.collectionName),s=(0,o.P)(t,(0,o._M)("createdBy","==",e)),l=await(0,o.GG)(s),n=[];return l.forEach(e=>{n.push((0,r.A)({id:e.id},e.data()))}),n}catch(t){throw console.error("Error getting user votes:",t),t}}async deleteVote(e,t){try{const s=(0,o.H9)(a.db,this.collectionName,e),r=await(0,o.x7)(s);if(!r.exists())throw new Error("Vote not found");if(r.data().createdBy!==t)throw new Error("Only the creator can delete this vote");await(0,o.kd)(s)}catch(s){throw console.error("Error deleting vote:",s),s}}async closeVote(e,t){try{const s=(0,o.H9)(a.db,this.collectionName,e),r=await(0,o.x7)(s);if(!r.exists())throw new Error("Vote not found");if(r.data().createdBy!==t)throw new Error("Only the creator can close this vote");await(0,o.mZ)(s,{status:"closed",updatedAt:o.Dc.now()})}catch(s){throw console.error("Error closing vote:",s),s}}subscribeToVote(e,t){const s=(0,o.H9)(a.db,this.collectionName,e);return(0,o.aQ)(s,e=>{e.exists()?t((0,r.A)({id:e.id},e.data())):t(null)},e=>{console.error("Error listening to vote updates:",e),t(null)})}async hasUserVoted(e,t){try{const s=await this.getVote(e);return!!s&&Object.values(s.votes).some(e=>{var s;return null===(s=e.voters)||void 0===s?void 0:s.includes(t)})}catch(s){return console.error("Error checking if user voted:",s),!1}}async getUserSelection(e,t){try{const s=await this.getVote(e);if(!s)return[];const r=[];return Object.entries(s.votes).forEach(e=>{let[s,o]=e;o.voters.includes(t)&&r.push(s)}),r}catch(s){return console.error("Error getting user selection:",s),[]}}async toggleLike(e,t,s,l,n){try{const i=(0,o.H9)(a.db,this.collectionName,e);await(0,o.c4)(a.db,async e=>{const a=await e.get(i);if(!a.exists())throw new Error("Vote not found");const c=a.data(),d=(0,r.A)({},c.votes);d[t]||(d[t]={count:0,voters:[],voterInfo:[],likes:0,likedBy:[],likeVoterInfo:[]}),d[t].likedBy||(d[t].likedBy=[],d[t].likes=0),d[t].likeVoterInfo||(d[t].likeVoterInfo=[]);const u=d[t].likedBy,h=u.includes(s),m={id:s,name:l,avatar:n,votedAt:o.Dc.now()};h?(d[t].likedBy=u.filter(e=>e!==s),d[t].likes=Math.max(0,(d[t].likes||0)-1),d[t].likeVoterInfo=d[t].likeVoterInfo.filter(e=>e.id!==s)):(d[t].likedBy=[...u,s],d[t].likes=(d[t].likes||0)+1,d[t].likeVoterInfo.push(m));let p=c.allVoters||[];const x=p.findIndex(e=>e.id===s);x>=0?p[x]=m:p=[...p,m],e.update(i,{votes:d,allVoters:p,updatedAt:o.Dc.now()})})}catch(i){throw console.error("Error toggling like:",i),i}}}}}]);